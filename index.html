<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>My Wealth</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>

<body data-view="auth">

    <div class="ambient-glow"></div>

    <div class="market-ticker-wrapper">
        <div class="ticker-content" id="ticker-bar">
            <span>جاري التحميل...</span>
        </div>
    </div>

    <section id="auth-section" class="view-section">
        <div class="container" style="height:80vh; display:flex; flex-direction:column; justify-content:center; text-align:center;">
            <i class="fa-solid fa-layer-group" style="font-size:3.5rem; color:var(--primary); margin-bottom:20px;"></i>
            <h1 style="margin:0 0 10px; font-size:1.8rem">My Wealth</h1>
            <p style="color:#888; margin-bottom:40px; font-size:0.9rem">إدارة الأصول ومحاكاة السوق</p>
            
            <input type="email" id="login-email" placeholder="البريد الإلكتروني">
            <input type="password" id="login-password" placeholder="كلمة المرور">
            <button class="btn-primary" id="login-btn">تسجيل الدخول</button>
        </div>
    </section>

    <section id="dashboard-section" class="view-section hidden">
        <div class="container">
            <div class="glass-card">
                <div class="mc-label">إجمالي الثروة</div>
                <h1 class="mc-value" id="total-net-worth">...</h1>
                <div class="mc-stats-row">
                    <div class="mc-stat">
                        <div class="mc-label">العائد الكلي</div>
                        <div class="val" id="total-roi">--%</div>
                    </div>
                    <div class="mc-stat">
                        <div class="mc-label">المخاطرة R/R</div>
                        <div class="val" id="global-rr">--</div>
                    </div>
                </div>
            </div>

            <div class="section-header">
                <h3>المحافظ</h3>
                <button class="btn-add-stylish" id="create-portfolio-btn">
                    <i class="fa-solid fa-plus"></i> إضافة
                </button>
            </div>
            
            <div id="portfolios-container"></div>
        </div>
    </section>

    <section id="details-section" class="view-section hidden">
        <div class="container">
            <div class="section-header">
                <button class="btn-text" onclick="window.setView('dashboard')">
                    <i class="fa-solid fa-chevron-right"></i> رجوع
                </button>
                <button class="btn-text" style="color:var(--danger)" onclick="window.deleteCurrentPortfolio()">
                    <i class="fa-solid fa-trash"></i>
                </button>
            </div>

            <div class="glass-card">
                <div style="display:flex; justify-content:space-between; align-items:center">
                    <h2 id="d-p-name" style="margin:0">...</h2>
                    <h3 id="d-p-val" style="margin:0; font-family:'Inter'; color:#aaa">...</h3>
                </div>
                <div style="height:200px; margin-top:20px; position:relative">
                    <canvas id="portfolioChart"></canvas>
                </div>
            </div>

            <div class="section-header">
                <h3>الأصول</h3>
                <button class="btn-add-stylish" onclick="window.showAddAssetModal()">
                    <i class="fa-solid fa-plus"></i> أصل
                </button>
            </div>
            <div id="assets-list"></div>
        </div>
    </section>

    <section id="journal-section" class="view-section hidden">
        <div class="container">
            <div class="section-header">
                <h3>سجل الصفقات</h3>
                <button class="btn-add-stylish" id="add-trade-btn">
                    <i class="fa-solid fa-plus"></i> صفقة
                </button>
            </div>

            <div style="display:flex; gap:10px; margin-bottom:15px">
                <div class="glass-card" style="flex:1; padding:15px; margin:0; text-align:center">
                    <div class="mc-label">مفتوحة</div>
                    <strong id="j-open-count" style="font-size:1.1rem">0</strong>
                </div>
                <div class="glass-card" style="flex:1; padding:15px; margin:0; text-align:center">
                    <div class="mc-label">صافي الربح</div>
                    <strong id="j-total-pnl" class="text-green" style="font-size:1.1rem; font-family:'Inter'">0</strong>
                </div>
            </div>

            <div class="chart-controls">
                <span style="font-size:0.8rem; color:#888;">الحالة:</span>
                <div class="filters">
                    <button class="f-btn active" data-j-filter="OPEN">نشطة</button>
                    <button class="f-btn" data-j-filter="CLOSED">مغلقة</button>
                </div>
            </div>

            <div id="journal-list"></div>
        </div>
    </section>

    <section id="calculator-section" class="view-section hidden">
        <div class="container">
            <h3 style="margin-bottom:15px">أدوات التداول</h3>
            
            <div class="glass-card" style="padding:15px">
                <div class="segmented-control">
                    <button class="seg-btn active" onclick="window.switchCalcTab('fees', this)">العمولات</button>
                    <button class="seg-btn" onclick="window.switchCalcTab('avg', this)">المتوسطات</button>
                    <button class="seg-btn" onclick="window.switchCalcTab('risk', this)">المخاطرة</button>
                </div>

                <div id="calc-fees" class="calc-tab-content active">
                    <div class="radio-group">
                        <div class="radio-label selected" onclick="window.selectBroker('thndr', this)">Thndr</div>
                        <div class="radio-label" onclick="window.selectBroker('other', this)">تقليدي</div>
                    </div>
                    <div class="compact-grid">
                        <input type="number" id="c-buy" class="compact-input" placeholder="سعر الشراء" oninput="window.calcCommission()">
                        <input type="number" id="c-sell" class="compact-input" placeholder="سعر البيع" oninput="window.calcCommission()">
                    </div>
                    <input type="number" id="c-qty" class="compact-input" placeholder="الكمية" oninput="window.calcCommission()" style="width:100%">

                    <div class="calc-result-box">
                        <div class="mc-label">الربح الصافي</div>
                        <h2 id="c-result" style="margin:5px 0; direction:ltr; font-size:1.8rem">0.00</h2>
                        <div style="font-size:0.75rem; color:#888">الرسوم: <span id="c-fees">0.00</span></div>
                    </div>
                </div>

                <div id="calc-avg" class="calc-tab-content">
                    <div class="compact-grid">
                        <input type="number" id="avg-curr-qty" class="compact-input" placeholder="الكمية الحالية">
                        <input type="number" id="avg-curr-price" class="compact-input" placeholder="المتوسط الحالي">
                    </div>
                    <div class="compact-grid">
                        <input type="number" id="avg-new-qty" class="compact-input" placeholder="كمية جديدة">
                        <input type="number" id="avg-new-price" class="compact-input" placeholder="سعر جديد">
                    </div>
                    <button class="btn-primary" style="background:#222; margin-top:5px; padding:10px" onclick="window.calcAverage()">احسب</button>
                    
                    <div class="calc-result-box">
                        <div class="mc-label">المتوسط الجديد</div>
                        <h2 id="avg-result" style="margin:5px 0; color:var(--gold); font-size:1.8rem">0.00</h2>
                    </div>
                </div>

                <div id="calc-risk" class="calc-tab-content">
                    <input type="number" id="rr-entry" class="compact-input" placeholder="سعر الدخول" oninput="window.calcRR()" style="width:100%; margin-bottom:10px">
                    <div class="compact-grid">
                        <input type="number" id="rr-target" class="compact-input" placeholder="الهدف" oninput="window.calcRR()">
                        <input type="number" id="rr-stop" class="compact-input" placeholder="الوقف" oninput="window.calcRR()">
                    </div>
                    
                    <div class="calc-result-box">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px">
                            <div style="font-size:0.8rem">ربح: <span class="text-green" id="rr-profit">0%</span></div>
                            <div style="font-size:0.8rem">خسارة: <span class="text-danger" id="rr-loss">0%</span></div>
                        </div>
                        <div class="mc-label">نسبة العائد (R:R)</div>
                        <h2 id="rr-ratio" style="margin:5px 0; font-size:1.8rem">0 : 0</h2>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <section id="settings-section" class="view-section hidden">
        <div class="container">
            <h3>الإعدادات</h3>
            <div class="glass-card">
                <button class="btn-primary" onclick="window.exportBackup()" style="margin-bottom:10px; background:#2c2c2e">
                    <i class="fa-solid fa-download"></i> تصدير البيانات (JSON)
                </button>
                <button class="btn-primary" onclick="document.getElementById('backup-upload').click()" style="margin-bottom:10px; background:#2c2c2e">
                    <i class="fa-solid fa-upload"></i> استعادة نسخة
                </button>
            </div>
            <button class="btn-primary" style="background:var(--danger)" id="logout-btn-settings">تسجيل الخروج</button>
        </div>
    </section>

    <nav class="glass-dock" id="main-nav">
        <button class="nav-item active" id="nav-home"><i class="fa-solid fa-house"></i></button>
        <button class="nav-item" id="nav-calculator"><i class="fa-solid fa-calculator"></i></button>
        <button class="nav-item" id="nav-journal"><i class="fa-solid fa-book-open"></i></button>
        <button class="nav-item" id="nav-settings"><i class="fa-solid fa-gear"></i></button>
    </nav>

    <div id="modal-overlay" class="modal-overlay hidden">
        <div class="modal-content" id="modal-box"></div>
    </div>

    <input type="file" id="backup-upload" accept=".json" style="display:none">
    <input type="file" id="excel-upload" accept=".xlsx, .xls, .csv" style="display:none">

    <script type="module" src="app.js"></script>
</body>
</html>